+++
date = "2017-12-18"
tags = [ "ethereum", "truffle", "solidity", "blockchain" ]
title = "ä»®æƒ³å­çŒ«çµŒæ¸ˆã‚’æ”¯ãˆã‚‹ ERC721"
+++

ã“ã®è¨˜äº‹ã¯ [ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ Advent Calendar 2017](https://qiita.com/advent-calendar/2017/blockchain) ã® 18 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€è¿‘é ƒ Ethereum ç•Œéšˆã§äººæ°—ã‚’åšã—ã¦ã„ã‚‹ Ãappã€Œ[CryptoKitties](https://www.cryptokitties.co)ã€ãŒåˆ©ç”¨ã—ã¦ã„ã‚‹ ERC721ï¼ˆâ€»ã¾ã ãƒ‰ãƒ©ãƒ•ãƒˆæ®µéšãªã®ã§æ³¨æ„ï¼‰ã¨ã„ã†ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»•æ§˜ã«ã¤ã„ã¦ç´¹ä»‹ã™ã‚‹ã¨ã¨ã‚‚ã«ã€å®Ÿè£…ãƒ»å‹•ä½œç¢ºèªã‚’é€šã—ã¦ ERC721 ã«å¯¾ã™ã‚‹ç†è§£ã‚’æ·±ã‚ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

<!--more-->

<br />
## CryptoKitties ã«ã¤ã„ã¦

ã“ã®è¨˜äº‹ã¯ CryptoKitties ã«ã¤ã„ã¦èª¬æ˜ã™ã‚‹ã®ãŒç›®çš„ã§ã¯ãªã„ã®ã§ã€ã–ã£ãã‚Šã¨ç´¹ä»‹ã ã‘ã€‚

ã¾ãšã€èªå¼Šã‚’è¦šæ‚Ÿã§ä¸€è¨€ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¼ãˆã‚‹ã¨

__Blockchain ä¸Šã§è‚²ã¦ã‚‹ãŸã¾ã”ã£ã¡__

ã¿ãŸã„ãªã‚‚ã®ã§ã™ï¼ˆãˆã€ãŸã¾ã”ã£ã¡ã‚’çŸ¥ã‚‰ãªã„ã ã£ã¦ã€‚ã€‚ã€‚ï¼Ÿãªã‚“ã¦ã“ã£ãŸã€‚ã€‚ã€‚ï¼‰ã€‚

![crypto-kitties](/my-images/entry/crypto-kitties.png)

ã“ã‚ŒãŒã€è¿‘é ƒ Ethereum ç•Œéšˆã§ä¸€å¤§ãƒ–ãƒ¼ãƒ ã‚’å·»ãèµ·ã“ã—ãŸã¨ã„ã†ã‚ã‘ã§ã™ã€‚

ref. [ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ä¸Šã§ã€Œä»®æƒ³å­çŒ«ã€è‚²æˆã‚²ãƒ¼ãƒ ãŒäººæ°—ã€å–å¼•ã®ï¼”ï¼…å ã‚ã‚‹](https://jp.cointelegraph.com/news/viral-cat-game-responsible-for-huge-portion-of-ethereum-transactions)

ä¸Šè¨˜ã®è¨˜äº‹ã«ã‚‚ã•ã‚‰ã£ã¨ç›®ã‚’é€šã—ã¦ã„ãŸã ã‘ã‚Œã° CryptoKitties ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã ã„ãŸã„æ´ã‚“ã§ã‚‚ã‚‰ãˆã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚ä¸€å¿œã€[å…¬å¼ã‚µã‚¤ãƒˆ](https://www.cryptokitties.co) ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ç´¹ä»‹æ–‡ã‚‚å¼•ç”¨ã—ã¦ãŠãã¾ã™ã€‚

> CryptoKitties is a game centered around breedable, collectible, and oh-so-adorable creatures we call CryptoKitties! Each cat is one-of-a-kind and 100% owned by you; it cannot be replicated, taken away, or destroyed.

ã–ã£ãã‚Šè¨³ã™ã¨ã€

__CryptoKitties ã¯ã€ç¹æ®–ã§ãã¦åé›†ã‚‚ã§ãã‚‹ã€ã‹ã‚ã„ãã¦ã‹ã‚ã„ãã¦ãŸã¾ã‚‰ãªã„ç”Ÿãç‰©ã€CryptoKitty ã‚’ä¸­å¿ƒã¨ã—ãŸã‚²ãƒ¼ãƒ ã§ã™ï¼CryptoKitty ã®æ‰€æœ‰æ¨©ã¯ 100 % ã‚ãªãŸã®ã‚‚ã®ã§ã™ã€‚è¤‡è£½ã•ã‚Œã‚‹ã“ã¨ã‚‚ã€å¥ªå–ã•ã‚Œã‚‹ã“ã¨ã‚‚ã€ç ´å£Šã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚__

ã¨ã„ã†æ„Ÿã˜ã§ã—ã‚‡ã†ã‹ã€‚

ã€Œæ‰€æœ‰æ¨©ã¯ 100 % ã‚ãªãŸã®ã‚‚ã®ã€ã¨ã¯è¨€ã£ã¦ã„ã¾ã™ãŒã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’è¦‹ã‚‹é™ã‚Šã€ã„ãã¤ã‹ã®ç®¡ç†æ“ä½œæ¨©é™ï¼ˆCryptoKitty ã®å–å¼•ã‚’åœæ­¢ã™ã‚‹æ¨©åˆ©ãªã©ï¼‰ã¯ã‚²ãƒ¼ãƒ é–‹ç™ºå´ãŒä¿æœ‰ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚æ°—ã«ãªã‚‹æ–¹ã¯ [å®Ÿéš›ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ](https://etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#code) ã‚’ã”è¦§ãã ã•ã„ã€‚

ã¾ãŸã€What's the big deal? ã¨ã„ã†å•ã„ã«å¯¾ã™ã‚‹å›ç­”ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

> CryptoKitties is one of the worldâ€™s first games to be built on blockchain technology - the same breakthrough that makes things like Bitcoin and Ethereum possible. Bitcoin and ether are cryptocurrencies but CryptoKitties are cryptocollectibles. You can buy, sell, or trade your CryptoKitty like it was a traditional collectible, secure in the knowledge that blockchain will track ownership securely.

ã“ã‚Œã‚‚ã–ã£ãã‚Šè¨³ã™ã¨ã€

__CryptoKitties ã¯ã€Blockchain æŠ€è¡“ã‚’åŸºã«æ§‹ç¯‰ã•ã‚ŒãŸä¸–ç•Œåˆã®ã‚²ãƒ¼ãƒ ã® 1 ã¤ã§ã™ã€‚ã“ã®ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¹ãƒ«ãƒ¼ã«ã‚ˆã£ã¦ã€Bitcoin ã‚„ Ethereum ã¨åŒç­‰ã®ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚Bitcoin ã‚„ Ether ã¯ä»®æƒ³é€šè²¨ã§ã™ãŒã€CryptoKitties ã¯ä»®æƒ³åé›†å“ã§ã™ã€‚å¾“æ¥ã®åé›†å“ã¨åŒæ§˜ã€CryptoKitty ã¯è³¼å…¥ãƒ»å£²å´ãƒ»äº¤æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€ãã®æ‰€æœ‰æ¨©ã¯ Blockchain ã«ã‚ˆã£ã¦ç›£è¦–ã•ã‚Œã‚‹ãŸã‚ã€å®‰å…¨ã§ã™ã€‚__

ã¨ã„ã†æ„Ÿã˜ã§ã—ã‚‡ã†ã‹ã€‚

ã‚‚ã£ã¨è©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹ã¯ã€[å…¬å¼ã® FAQ](https://www.cryptokitties.co/faq) ã‚’å‚ç…§ã—ãŸã‚Šã€[MetaMask](https://metamask.io) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿéš›ã«ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã—ã¦ã¿ã‚‹ã¨ã‚ˆã„ã‹ã¨æ€ã„ã¾ã™ã€‚

<br />
## ä»®æƒ³å­çŒ«ã®æ­£ä½“ã«ã¤ã„ã¦

ã•ã¦ã€‚ã“ã®è¨˜äº‹ã®æœ¬é¡Œã€ãã‚Œã¯ã€

__ä»®æƒ³å­çŒ« CryptoKitty ã®æ­£ä½“__

ã§ã™ã€‚

ã¯ã„ã€‚ã“ã‚Œã€å®Ÿã¯ãƒˆãƒ¼ã‚¯ãƒ³ãªã‚“ã§ã™ã­ã€‚ãŸã ã€ç¾åœ¨æœ€ã‚‚åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã§ã‚ã‚ã† [ERC20](https://theethereum.wiki/w/index.php/ERC20_Token_Standard) æº–æ‹ ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã¯å°‘ã—é•ã†ã€

__fungibility ãŒãªã„ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆNon-Fungible Tokenï¼šNFTï¼‰__

ã¨ãªã‚Šã¾ã™

ã€Œfungibility ã¨ã¯ãªã‚“ãã‚„ï¼Ÿã€ã¨ã„ã†æ–¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã«ç›®ã‚’é€šã—ã¦ã„ãŸã ãã®ãŒã‚ˆã„ã‹ã¨æ€ã„ã¾ã™ï¼ˆ[@indiv_0110](https://twitter.com/indiv_0110) ã•ã‚“ã€ã„ã¤ã‚‚è‰¯è³ªãªè¨˜äº‹ã‚’ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ğŸ™ï¼‰ã€‚

ref. [åŒ¿åé€šè²¨ã¨Fungibilityï¼ˆä»£æ›¿æ€§ï¼‰](http://individua1.net/anonymous-cryptocurrency-fungibility)

CryptoKitties ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ NFT ã¯ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã™ã‚‹ä¿æœ‰é‡ã‚’ãƒ™ãƒ¼ã‚¹ã«ç®¡ç†ã•ã‚Œã‚‹ ERC20 æº–æ‹ ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¨ç•°ãªã‚Šã€

__1 ã¤ 1 ã¤ã®ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒã‚ã‚Šã€ä¿æœ‰è€…ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹__

ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚CryptoKitty 1 åŒ¹ 1 åŒ¹ãŒã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æŒã£ã¦ã„ã¦ã€ãã®é£¼ã„ä¸»ãŒã„ã‚‹ã¨ã„ã†ã®ã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ã„ã‹ã¨æ€ã„ã¾ã™ã€‚

ãã—ã¦ã€ã“ã® NFT ã®ä»•æ§˜ãŒã€ã“ã®è¨˜äº‹ã§ç€ç›®ã—ãŸã„ ERC721 ã¨ãªã‚Šã¾ã™ã€‚

<br />
## ERC721 ã«ã¤ã„ã¦

å‰è¿°ã—ãŸé€šã‚Šã€ERC721 ã¯ CryptoKitties ã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ NFT ã® 1 ä»•æ§˜ã§ã™ã€‚ç¾åœ¨ã€ã“ã‚Œã‚’ ERC20 ã®ã‚ˆã†ã«æ¨™æº–åŒ–ã—ã‚ˆã†ã¨ã„ã†å‹•ããŒã‚ã‚Šã€ä»¥ä¸‹ã® GitHub issue ã«ã¦è­°è«–ãŒãªã•ã‚Œã¦ã„ã¾ã™ã€‚

ref. [ERC: Non-fungible Token Standard](https://github.com/ethereum/EIPs/issues/721)

ã¤ã¾ã‚Šã€åŸ·ç­†æ™‚ç‚¹ã§ã¯ã¾ã æ­£å¼ãªä»•æ§˜ã§ã¯ãªã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚

ã¨ã„ã†ã“ã¨ã§ã€ã“ã®è¨˜äº‹ã§ã¯ CryptoKitties ã§å®Ÿéš›ã«ä½¿ã‚ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä»•æ§˜ã‚’åˆ©ç”¨ã—ã¦èª¬æ˜ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚æœ€çµ‚ç‰ˆã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ç•°ãªã£ãŸã‚‚ã®ã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã®ã§ã€ä»Šå›ã¯

__NFT ãŒã©ã‚“ãªé¢¨ã«å®Ÿç¾ã•ã‚Œã¦ã„ã‚‹ã®ã‹ã‚’ã–ã£ãã‚Šã¨ç†è§£ã™ã‚‹ã“ã¨__

ã«ä¸»çœ¼ã‚’ç½®ããªãŒã‚‰é€²ã‚ã¾ã™ã€‚

ã¾ãšã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ [CryptoKitties ã§å®Ÿéš›ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ](https://etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#code) ã‹ã‚‰æŠ½å‡ºã—ã¦ã¿ã¾ã™ã€‚ERC20 ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ã”å­˜çŸ¥ã®æ–¹ã¯ã€ã“ã‚Œã‚’è¦‹ã‚‹ã ã‘ã§ã©ã‚“ãªã‚‚ã®ãªã®ã‹ã ã„ãŸã„æŠŠæ¡ã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

```
pragma solidity ^0.4.18;

/// @title Interface for contracts conforming to ERC-721: Non-Fungible Tokens
/// @author Dieter Shirley <dete@axiomzen.co> (https://github.com/dete)
contract ERC721 {
    // Required methods
    function totalSupply() public view returns (uint256 total);
    function balanceOf(address _owner) public view returns (uint256 balance);
    function ownerOf(uint256 _tokenId) external view returns (address owner);
    function approve(address _to, uint256 _tokenId) external;
    function transfer(address _to, uint256 _tokenId) external;
    function transferFrom(address _from, address _to, uint256 _tokenId) external;

    // Events
    event Transfer(address from, address to, uint256 tokenId);
    event Approval(address owner, address approved, uint256 tokenId);

    // Optional
    // function name() public view returns (string name);
    // function symbol() public view returns (string symbol);
    // function tokensOfOwner(address _owner) external view returns (uint256[] tokenIds);
    // function tokenMetadata(uint256 _tokenId, string _preferredTransport) public view returns (string infoUrl);

    // ERC-165 Compatibility (https://github.com/ethereum/EIPs/issues/165)
    function supportsInterface(bytes4 _interfaceID) external view returns (bool);
}
```

ERC20 ã£ã½ã„ã¨ã¯ã„ãˆã€è¦‹æ…£ã‚Œãªã„åå‰ã® function ã‚‚ã„ãã¤ã‹ã‚ã‚‹ã‚ˆã†ã§ã™ã®ã§ã€ä¸Šã‹ã‚‰ 1 ã¤ 1 ã¤è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€ã€ã¨è¨€ã„ãŸã„ã¨ã“ã‚ãªã®ã§ã™ãŒã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã ã‘ã§èª¬æ˜ã™ã‚‹ã‚ˆã‚Šã‚‚å®Ÿè£…ãŒä¼´ã£ã¦ã„ãŸæ–¹ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ãã†ã ãªã¨æ€ã£ãŸã®ã§ã€ä»¥ä¸‹ã€è‡ªåˆ†ã®ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ã‚’ãƒ™ãƒ¼ã‚¹ã«èª¬æ˜ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

<br />
## ERC721 ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹

CryptoKitties ã§å®Ÿéš›ã«ä½¿ã‚ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® ERC721 ã®ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ãŒã“ã¡ã‚‰ã§ã™ã€‚

<div class="github-card" data-user="m0t0k1ch1" data-repo="ERC721-token-sample"></div>
<script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script>

CryptoKitties ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾æŒã£ã¦ãã¦èª¬æ˜ã—ã¦ã‚‚ã‚ˆã‹ã£ãŸã®ã§ã™ãŒã€ERC721 ã®åˆæ­©çš„ãªç†è§£ã«ã¯å¿…è¦ãªã„ã§ã‚ã‚ã† CryptoKitties ç‰¹æœ‰ã®å‡¦ç†ãŒãã‚Œãªã‚Šã«å…¥ã£ã¦ãã¦ã—ã¾ã†ãŸã‚ã€è‡ªåˆ†ã®æ€ã†æœ€å°é™ã‚’ `MyNonFungibleToken` ã¨ã—ã¦å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚ã¨ã¯ã„ãˆã€CryptoKitties ã®å®Ÿè£…ã¯å¤§ã„ã«å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ãã‚“ãªã«é•·ããªã„ã®ã§ã€ã¨ã‚Šã‚ãˆãšå…¨éƒ¨è²¼ã£ã¦ã—ã¾ãŠã†ã¨æ€ã„ã¾ã™ã€‚

```
pragma solidity ^0.4.18;

import "./ERC721.sol";

contract MyNonFungibleToken is ERC721 {
  /*** CONSTANTS ***/

  string public constant name = "MyNonFungibleToken";
  string public constant symbol = "MNFT";

  bytes4 constant InterfaceID_ERC165 =
    bytes4(keccak256('supportsInterface(bytes4)'));

  bytes4 constant InterfaceID_ERC721 =
    bytes4(keccak256('name()')) ^
    bytes4(keccak256('symbol()')) ^
    bytes4(keccak256('totalSupply()')) ^
    bytes4(keccak256('balanceOf(address)')) ^
    bytes4(keccak256('ownerOf(uint256)')) ^
    bytes4(keccak256('approve(address,uint256)')) ^
    bytes4(keccak256('transfer(address,uint256)')) ^
    bytes4(keccak256('transferFrom(address,address,uint256)')) ^
    bytes4(keccak256('tokensOfOwner(address)'));


  /*** DATA TYPES ***/

  struct Token {
    address mintedBy;
    uint64 mintedAt;
  }


  /*** STORAGE ***/

  Token[] tokens;

  mapping (uint256 => address) public tokenIndexToOwner;
  mapping (address => uint256) ownershipTokenCount;
  mapping (uint256 => address) public tokenIndexToApproved;


  /*** EVENTS ***/

  event Mint(address owner, uint256 tokenId);


  /*** INTERNAL FUNCTIONS ***/

  function _owns(address _claimant, uint256 _tokenId) internal view returns (bool) {
    return tokenIndexToOwner[_tokenId] == _claimant;
  }

  function _approvedFor(address _claimant, uint256 _tokenId) internal view returns (bool) {
    return tokenIndexToApproved[_tokenId] == _claimant;
  }

  function _approve(address _to, uint256 _tokenId) internal {
    tokenIndexToApproved[_tokenId] = _to;

    Approval(tokenIndexToOwner[_tokenId], tokenIndexToApproved[_tokenId], _tokenId);
  }

  function _transfer(address _from, address _to, uint256 _tokenId) internal {
    ownershipTokenCount[_to]++;
    tokenIndexToOwner[_tokenId] = _to;

    if (_from != address(0)) {
      ownershipTokenCount[_from]--;
      delete tokenIndexToApproved[_tokenId];
    }

    Transfer(_from, _to, _tokenId);
  }

  function _mint(address _owner) internal returns (uint256 tokenId) {
    Token memory token = Token({
      mintedBy: _owner,
      mintedAt: uint64(now)
    });
    tokenId = tokens.push(token) - 1;

    Mint(_owner, tokenId);

    _transfer(0, _owner, tokenId);
  }


  /*** ERC721 IMPLEMENTATION ***/

  function supportsInterface(bytes4 _interfaceID) external view returns (bool) {
    return ((_interfaceID == InterfaceID_ERC165) || (_interfaceID == InterfaceID_ERC721));
  }

  function totalSupply() public view returns (uint256) {
    return tokens.length;
  }

  function balanceOf(address _owner) public view returns (uint256) {
    return ownershipTokenCount[_owner];
  }

  function ownerOf(uint256 _tokenId) external view returns (address owner) {
    owner = tokenIndexToOwner[_tokenId];

    require(owner != address(0));
  }

  function approve(address _to, uint256 _tokenId) external {
    require(_owns(msg.sender, _tokenId));

    _approve(_to, _tokenId);
  }

  function transfer(address _to, uint256 _tokenId) external {
    require(_to != address(0));
    require(_to != address(this));
    require(_owns(msg.sender, _tokenId));

    _transfer(msg.sender, _to, _tokenId);
  }

  function transferFrom(address _from, address _to, uint256 _tokenId) external {
    require(_to != address(0));
    require(_to != address(this));
    require(_approvedFor(msg.sender, _tokenId));
    require(_owns(_from, _tokenId));

    _transfer(_from, _to, _tokenId);
  }

  function tokensOfOwner(address _owner) external view returns (uint256[]) {
    uint256 balance = balanceOf(_owner);

    if (balance == 0) {
      return new uint256[](0);
    } else {
      uint256[] memory result = new uint256[](balance);
      uint256 maxTokenId = totalSupply();
      uint256 idx = 0;

      uint256 tokenId;
      for (tokenId = 1; tokenId <= maxTokenId; tokenId++) {
        if (tokenIndexToOwner[tokenId] == _owner) {
          result[idx] = tokenId;
          idx++;
        }
      }
    }

    return result;
  }


  /*** OTHER EXTERNAL FUNCTIONS ***/

  function mint() external returns (uint256) {
    return _mint(msg.sender);
  }

  function getToken(uint256 _tokenId) external view returns (address mintedBy, uint64 mintedAt) {
    Token memory token = tokens[_tokenId];

    mintedBy = token.mintedBy;
    mintedAt = token.mintedAt;
  }
}
```

ã•ã¦ã€ã“ã“ã‹ã‚‰ã¯ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½ã„ãªãŒã‚‰èª¬æ˜ã—ã¦ã„ã“ã†ã¨æ€ã†ã®ã§ã™ãŒã€1 ã¤æ³¨æ„ç‚¹ã¨ã—ã¦ã€

__ä»¥é™ã®èª¬æ˜ã«ãŠã„ã¦ã€å˜ã«ã€ŒERC721ã€ã¨è¡¨è¨˜ã—ãŸå ´åˆã€ã€ŒCryptoKitties ã§å®Ÿéš›ã«ä½¿ã‚ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® ERC721ã€ã‚’æŒ‡ã™__

ã“ã¨ã¨ã—ã¾ã™ã€‚ã”æ‰¿çŸ¥ãã ã•ã„ã€‚

ã¾ãšã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã„ãã¤ã‹ constant ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```
string public constant name = "MyNonFungibleToken";
string public constant symbol = "MNFT";

bytes4 constant InterfaceID_ERC165 =
  bytes4(keccak256('supportsInterface(bytes4)'));

bytes4 constant InterfaceID_ERC721 =
  bytes4(keccak256('name()')) ^
  bytes4(keccak256('symbol()')) ^
  bytes4(keccak256('totalSupply()')) ^
  bytes4(keccak256('balanceOf(address)')) ^
  bytes4(keccak256('ownerOf(uint256)')) ^
  bytes4(keccak256('approve(address,uint256)')) ^
  bytes4(keccak256('transfer(address,uint256)')) ^
  bytes4(keccak256('transferFrom(address,address,uint256)')) ^
  bytes4(keccak256('tokensOfOwner(address)'));
```

`name` ã¨ `symbol` ã¯ ERC20 ã§ã‚‚ãŠé¦´æŸ“ã¿ã§ã™ã­ã€‚ã€ŒBitcoinã€ã¨ã€ŒBTCã€ã¿ãŸã„ãªã‚‚ã®ã§ã™ã€‚ãªãŠã€ERC721 ã§ã¯ optional ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã€ã“ã‚Œã‚‰ã®å®šç¾©ã¯å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã¾ãŸã€ERC721 ã®è¦ä»¶ã«ã¯ [ERC165](https://github.com/ethereum/EIPs/issues/165) ã«æº–æ‹ ã™ã‚‹ã“ã¨ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€ERC165 ã¨ ERC721 ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ID ã‚‚å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ERC165 ã¯ã€ã–ã£ãã‚Šè¨€ã†ã¨ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒã©ã‚“ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã‹ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã™ã€‚ãŸã ã€ERC165 ã‚‚ã¾ã æ­£å¼ãªä»•æ§˜ã¨ã—ã¦èªã‚ã‚‰ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€ã“ã“ã§ã¯æ·±å…¥ã‚Šã—ã¾ã›ã‚“ã€‚

æ¬¡ã¯ã€`Token` struct ã®å®šç¾©ã§ã™ã€‚

```
struct Token {
  address mintedBy;
  uint64 mintedAt;
}
```

ã“ã‚ŒãŒãƒˆãƒ¼ã‚¯ãƒ³ã®å®Ÿä½“ã¨ãªã‚Šã¾ã™ã€‚ä»Šå›ã®å®Ÿè£…ã§ã¯ã€èª°ã§ã‚‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ãŸã®ã§ã€ã‚·ãƒ³ãƒ—ãƒ«ã«ã€ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œè€…ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚ŒãŸãƒ–ãƒ­ãƒƒã‚¯ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä¿æŒã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã©ã‚“ãªãƒˆãƒ¼ã‚¯ãƒ³ã«ã™ã‚‹ã‹ã¯ ERC721 ã§åˆ¶é™ã•ã‚Œã¦ã¯ã„ãªã„ã®ã§ã€required ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æº€ãŸã›ã‚‹ã®ã§ã‚ã‚Œã°è‡ªç”±ã«å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¬¡ã¯ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å½¹å‰²ã‚’æ‹…ã† array ã‚„ mapping ã®å®šç¾©ã§ã™ã€‚

```
Token[] tokens;

mapping (uint256 => address) public tokenIndexToOwner;
mapping (address => uint256) ownershipTokenCount;
mapping (uint256 => address) public tokenIndexToApproved;
```

`tokens` ã¯ã€ãã®åã®é€šã‚Šã€å…¨ã¦ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿æŒã™ã‚‹ array ã§ã‚ã‚Šã€ãã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã® ID ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚ã“ã‚Œã¯ CtyptoKitties ã«ãŠã„ã¦ã‚‚åŒæ§˜ã§ã™ã€‚

ãã—ã¦ã€ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ ID ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿æœ‰è€…ï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã‚’ç®¡ç†ã™ã‚‹ã®ãŒ `tokenIndexToOwner` ã§ã‚ã‚Šã€å„ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä¿æœ‰ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®åˆè¨ˆæ•°ã‚’ç®¡ç†ã™ã‚‹ã®ãŒ `ownershipTokenCount` ã§ã™ã€‚

ã¾ãŸã€ERC721 æº–æ‹ ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚‚èªå¯ï¼ˆä¿æœ‰è€…ä»¥å¤–ã«ãƒˆãƒ¼ã‚¯ãƒ³ã®ç§»å‹•ã‚’è¨±å¯ã™ã‚‹è¡Œç‚ºï¼‰ãŒå¯èƒ½ãªãŸã‚ã€èª°ãŒèªå¯ã•ã‚Œã¦ã„ã‚‹ã®ã‹ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã”ã¨ã«ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ç®¡ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã®ãŒ `tokenIndexToApproved` ã¨ãªã‚Šã¾ã™ã€‚ä»Šå›ã¯ç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ã¨ã„ã†ã“ã¨ã§ã€1 ãƒˆãƒ¼ã‚¯ãƒ³ã«å¯¾ã—ã¦ 1 ã‚¢ãƒ‰ãƒ¬ã‚¹ã—ã‹èªå¯ã§ããªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ãªãŠã€ã“ã‚Œã‚‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å®Ÿè£…ã‚‚ ERC721 ã§åˆ¶é™ã•ã‚Œã¦ã¯ã„ãªã„ã®ã§ã€required ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æº€ãŸã›ã‚‹ã®ã§ã‚ã‚Œã°è‡ªç”±ã«å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆä»Šå›ã¯ CryptoKitties ã¨åŒã˜ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ï¼‰ã€‚

æ¬¡ã¯ã€event ã®å®šç¾©ã§ã™ã€‚

```
event Mint(address owner, uint256 tokenId);
```

`Mint` event ã¯ ERC721 ã¨ã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ãŒã€ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œæ™‚ã«ç™ºè¡Œã™ã‚‹ event ã¨ã—ã¦è¿½åŠ ã§å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

`Transfer` event ã¨ `Approval` event ã¯ ERC721 ã«ãŠã‘ã‚‹å®šç¾©ã‚’ãã®ã¾ã¾ä½¿ã†ã®ã§ã€ã“ã“ã§ã¯å®šç¾©ã—ã¦ã„ã¾ã›ã‚“ã€‚ãã‚Œãã‚Œã€ãƒˆãƒ¼ã‚¯ãƒ³ã®ç§»å‹•æ™‚ã¨èªå¯æ™‚ã«ç™ºè¡Œã•ã‚Œã¾ã™ã€‚

ã•ã¦ã€‚ã“ã“ã‹ã‚‰ã¯ function ã®å®Ÿè£…éƒ¨åˆ†ã«å…¥ã£ã¦ã„ãã®ã§ã™ãŒã€1 ã¤ãšã¤èª¬æ˜ã—ã¦ã„ãã®ã‚‚å†—é•·ã§ã™ã—ã€ä¸Šè¿°ã—ãŸã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä»•æ§˜ã‚’åŠ å‘³ã™ã‚Œã°ç†è§£ã«è‹¦ã—ã‚€ function ã¯ãªã„ã¨æ€ã„ã¾ã™ã®ã§ã€å…¨ã¦ã® function ã®æ¦‚è¦ã‚’ã–ã£ã¨ã¾ã¨ã‚ã‚‹ã«ç•™ã‚ã‚ˆã†ã‹ã¨æ€ã„ã¾ã™ã€‚

### internal functions

definition|return|description
:---|:---|:---
`_owns(address _claimant, uint256 _tokenId) internal view`|`bool`|`_claimant` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã€`_tokenId` ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿æœ‰ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹
`_approvedFor(address _claimant, uint256 _tokenId) internal view`|`bool`|`_claimant` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã€`_tokenId` ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã«ã¤ã„ã¦èªå¯ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹
`_approve(address _to, uint256 _tokenId) internal`|-|`_tokenId` ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã¤ã„ã¦ã€`_to` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’èªå¯ã™ã‚‹
`_transfer(address _from, address _to, uint256 _tokenId) internal`|-|`_tokenId` ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã€`_from` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ `_to` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç§»å‹•ã•ã›ã‚‹
`_mint(address _owner) internal`|`uint256`|æ–°ã—ããƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ã€`_owner` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«ä¿æœ‰ã•ã›ã‚‹ï¼ˆè¿”ã‚Šå€¤ã¯ãƒˆãƒ¼ã‚¯ãƒ³ IDï¼‰


### ERC721 implementation

definition|return|description
:---|:---|:---
`supportsInterface(bytes4 _interfaceID) external view`|`bool`|æŒ‡å®šã•ã‚ŒãŸ `_interfaceID` ã«å¯¾å¿œã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ï¼ˆä»Šå›ã¯ ERC165 ã¨ ERC721 ã‚’å®Ÿè£…ï¼‰
`totalSupply() public view`|`uint256`|ãƒˆãƒ¼ã‚¯ãƒ³ã®ç·æ•°ã‚’å–å¾—ã™ã‚‹
`balanceOf(address _owner) public view`|`uint256`|`_owner` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä¿æœ‰ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®åˆè¨ˆæ•°ã‚’å–å¾—ã™ã‚‹
`ownerOf(uint256 _tokenId) external view`|`address`|`_tokenId` ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿æœ‰ã™ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹
`approve(address _to, uint256 _tokenId) external`|-|`msg.sender` ãŒä¿æœ‰ã™ã‚‹ `_tokenId` ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã«ã¤ã„ã¦ã€`_to` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’èªå¯ï¼ˆ`_approve`ï¼‰ã™ã‚‹
`transfer(address _to, uint256 _tokenId) external`|-|`msg.sender` ãŒä¿æœ‰ã™ã‚‹ `_tokenId` ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã€`_to` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç§»å‹•ï¼ˆ`_transfer`ï¼‰ã•ã›ã‚‹
`transferFrom(address _from, address _to, uint256 _tokenId) external`|-|`msg.sender` ãŒèªå¯ã•ã‚ŒãŸ `_tokenId` ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã€`_from` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ `_to` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç§»å‹•ï¼ˆ`_transfer`ï¼‰ã•ã›ã‚‹
`tokensOfOwner(address _owner) external view`|`uint256[]`|`_owner` ã§æŒ‡å®šã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä¿æœ‰ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒˆãƒ¼ã‚¯ãƒ³ ID ä¸€è¦§ã‚’å–å¾—ã™ã‚‹

### other external functions

definition|return|description
:---|:---|:---
`mint() external`|`uint256`|æ–°ã—ããƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œï¼ˆ`_mint`ï¼‰ã—ã€`msg.sender` ã«ä¿æœ‰ã•ã›ã‚‹
`getToken(uint256 _tokenId) external view`|`address, uint64`|`_tokenId` ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ˆè¿”ã‚Šå€¤ã¯ã€`mintedBy` ã¨ `mintedAt`ï¼‰

ERC20 ã¨ã®å¤§ããªé•ã„ã¯ã€

__å„ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€å„ãƒˆãƒ¼ã‚¯ãƒ³ã«å¯¾ã—ã¦æ“ä½œã‚’è¡Œã†éš›ã«ãƒˆãƒ¼ã‚¯ãƒ³ ID ã‚’æŒ‡å®šã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚‹__

ã¨ã„ã†ç‚¹ã¨ãªã‚Šã¾ã™ã€‚ã“ã®ç‚¹ã‚’ç†è§£ã™ã‚Œã°ã€ç‰¹ã«é›£ã—ã„ã“ã¨ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚

ãªãŠã€ä»Šå›ã¯ ERC721 ã¨é–¢ä¿‚ã®ãªã„ external function ã¨ã—ã¦ã€`mint` ã¨ `getToken` ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚`mint` ã«ã¤ã„ã¦ã¯ã€ã“ã‚ŒãŒãªã„ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã™ã‚‹è¡“ãŒãªã„ãŸã‚ã€å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚`getToken` ã¯å¿…é ˆã§ã¯ãªã„ã®ã§ã™ãŒã€åˆ©ä¾¿æ€§ã‚’åŠ å‘³ã—ã¦å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

ãã®ä»–ã®æ³¨æ„ç‚¹ã¨ã—ã¦ã€`tokensOfOwner` ã¨ã„ã†éå¸¸ã«å±é™ºãªé¦™ã‚Šã®ã™ã‚‹ function ãŒã‚ã‚Šã¾ã™ã€‚ãªãœãªã‚‰ã€CryptoKitties ã®å®Ÿè£…ã«ç¿’ã„ã€ãƒˆãƒ¼ã‚¯ãƒ³ã®ç·æ•°åˆ†ãƒ«ãƒ¼ãƒ—ã‚’ã¶ã‚“å›ã™ã¨ã„ã†æ¼¢æ°—æº¢ã‚Œã‚‹ä»•æ§˜ã«ãªã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚ã“ã‚Œã«ã¤ã„ã¦ã¯ã€æœ¬å®¶ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ¡ãƒ³ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚çµæœã‚’æ ¼ç´ã™ã‚‹é…åˆ—ã¯ `memory` ã‚’æŒ‡å®šã—ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã®ã§ã€ãã®ç‚¹ã«ã¤ã„ã¦ã‚‚æ³¨æ„ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

> This method MUST NEVER be called by smart contract code. First, it's fairly expensive (it walks the entire Kitty array looking for cats belonging to owner), but it also returns a dynamic array, which is only supported for web3 calls, and not contract-to-contract calls.

`tokensOfOwner` ã«é¡ã™ã‚‹ function ã‚’ã©ã†ã™ã‚‹ã‹ã¯ã€ERC721 ã«å¯¾å¿œã™ã‚‹ GitHub issue ã§ã‚‚è­°è«–ã•ã‚Œã¦ãŠã‚Šã€[ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆ](https://github.com/ethereum/EIPs/issues/721#issuecomment-344018801) ãªã©ã‹ã‚‰ã€ãã®æ§˜å­ã‚’ä¼ºã†ã“ã¨ãŒã§ãã¾ã™ã€‚

<br />
## å®Ÿè£…ã—ãŸã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å‹•ã‹ã—ã¦ã¿ã‚‹

ã“ã“ã§ã¯ã€ç´¹ä»‹ã—ãŸ ERC721 ã®ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ã«ã¤ã„ã¦ã€[truffle](http://truffleframework.com) ã‚’ç”¨ã„ã¦ç°¡å˜ãªå‹•ä½œç¢ºèªã‚’è¡Œã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ãªãŠã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ã®çŠ¶æ…‹ã‚’å‰æã¨ã—ã¾ã™ã€‚

ã¾ãšã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã¤ãã‚Šã¾ã™ã€‚

``` sh
truffle(development)> token = MyNonFungibleToken.at(MyNonFungibleToken.address)
...
```

`name` ã¨ `symbol` ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

``` sh
truffle(development)> token.name()
'MyNonFungibleToken'
truffle(development)> token.symbol()
'MNFT'
```

ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã¦ãªã®ã§ã€`totalSupply` ã‚‚ã¾ã  0 ã§ã™ã€‚

``` sh
truffle(development)> token.totalSupply()
BigNumber { s: 1, e: 0, c: [ 0 ] }
```

è©¦ã—ã« 3 ã¤ãã‚‰ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ã¦ã¿ã¾ã™ã€‚

``` sh
truffle(development)> token.mint()
...
truffle(development)> token.mint()
...
truffle(development)> token.mint()
...
```

æƒ³å®šé€šã‚Šã€`totalSupply` ã¯ 3 ã«ãªã£ã¦ã„ã¾ã™ã€‚

``` sh
truffle(development)> token.totalSupply()
BigNumber { s: 1, e: 0, c: [ 3 ] }
```

`mint` ã‚’å®Ÿè¡Œã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä¿æœ‰ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ä¸€è¦§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€ID ãŒ 0ã€1ã€2 ã®ãƒˆãƒ¼ã‚¯ãƒ³ 3 ã¤ãŒä¿æœ‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

``` sh
truffle(development)> token.tokensOfOwner(web3.eth.accounts[0])
[ BigNumber { s: 1, e: 0, c: [ 1 ] },
  BigNumber { s: 1, e: 0, c: [ 2 ] },
  BigNumber { s: 1, e: 0, c: [ 0 ] } ]
```

å½“ç„¶ã€ä¿æœ‰ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®åˆè¨ˆæ•°ã¯ 3 ã§ã™ã€‚

``` sh
truffle(development)> token.balanceOf(web3.eth.accounts[0])
BigNumber { s: 1, e: 0, c: [ 3 ] }
```

å„ãƒˆãƒ¼ã‚¯ãƒ³ã®æƒ…å ±ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚ç™ºè¡Œè€…ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã€ç™ºè¡Œã•ã‚ŒãŸãƒ–ãƒ­ãƒƒã‚¯ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒé–²è¦§ã§ãã¾ã™ã€‚

``` sh
truffle(development)> token.getToken(0)
[ '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  BigNumber { s: 1, e: 9, c: [ 1513623273 ] } ]
truffle(development)> token.getToken(1)
[ '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  BigNumber { s: 1, e: 9, c: [ 1513623279 ] } ]
truffle(development)> token.getToken(2)
[ '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  BigNumber { s: 1, e: 9, c: [ 1513623280 ] } ]
```

IDï¼š1 ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ `web3.eth.accounts[1]` ã«ç§»å‹•ã•ã›ã¦ã¿ã¾ã™ã€‚

``` sh
truffle(development)> token.transfer(web3.eth.accounts[1], 1)
...
```

çµæœã¯å¾Œã»ã©ç¢ºèªã™ã‚‹ã¨ã—ã¦ã€æ¬¡ã« IDï¼š2 ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ `web3.eth.accounts[2]` ã«ç§»å‹•ã•ã›ã¦ã¿ã¾ã™ã€‚ä»Šå›ã¯ `approve` ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

``` sh
truffle(development)> token.approve(web3.eth.accounts[2], 2)
...
truffle(development)> token.transferFrom(web3.eth.accounts[0], web3.eth.accounts[2], 2, {from: web3.eth.accounts[2]})
...
```

`transferFrom` ã¯èªå¯ã•ã‚ŒãŸå´ãŒå®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã®ã§ã€`{from: web3.eth.accounts[2]}` ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

ç§»å‹•çµæœã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚ã¾ãšã¯å„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä¿æœ‰ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®åˆè¨ˆæ•°ã§ã™ã€‚æƒ³å®šé€šã‚Šã€1 ã¤ãšã¤ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿æœ‰ã—ã¦ã„ã¾ã™ã€‚

``` sh
truffle(development)> token.balanceOf(web3.eth.accounts[0])
BigNumber { s: 1, e: 0, c: [ 1 ] }
truffle(development)> token.balanceOf(web3.eth.accounts[1])
BigNumber { s: 1, e: 0, c: [ 1 ] }
truffle(development)> token.balanceOf(web3.eth.accounts[2])
BigNumber { s: 1, e: 0, c: [ 1 ] }
```

æ¬¡ã«ã€å„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä¿æœ‰ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ä¸€è¦§ã§ã™ã€‚ã“ã‚Œã‚‚æƒ³å®šé€šã‚Šã§ã™ã€‚

``` sh
truffle(development)> token.tokensOfOwner(web3.eth.accounts[0])
[ BigNumber { s: 1, e: 0, c: [ 0 ] } ]
truffle(development)> token.tokensOfOwner(web3.eth.accounts[1])
[ BigNumber { s: 1, e: 0, c: [ 1 ] } ]
truffle(development)> token.tokensOfOwner(web3.eth.accounts[2])
[ BigNumber { s: 1, e: 0, c: [ 2 ] } ]
```

å¿µã®ãŸã‚ã€`ownerOf` ã§å„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿æœ‰ã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

``` sh
truffle(development)> token.ownerOf(0).then(function(owner) { console.log(owner == web3.eth.accounts[0]) })
true
undefined
truffle(development)> token.ownerOf(1).then(function(owner) { console.log(owner == web3.eth.accounts[1]) })
true
undefined
truffle(development)> token.ownerOf(2).then(function(owner) { console.log(owner == web3.eth.accounts[2]) })
true
undefined
```

ã“ã¡ã‚‰ã‚‚æƒ³å®šé€šã‚Šã®çµæœã¨ãªã‚Šã¾ã—ãŸã€‚å•é¡Œãªã•ãã†ã§ã™ã€‚

<br />
## ã¾ã¨ã‚

- æ¨™æº–åŒ–ã«å‘ã‘ã¦è­°è«–ãŒé€²ã‚“ã§ã„ã‚‹ NFTï¼ˆNon-Fungible Tokenï¼‰ã®ä»•æ§˜ã§ã‚ã‚‹ ERC721 ã«ã¤ã„ã¦ã€ãã‚ŒãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ Ãapp ã§ã‚ã‚‹ CryptoKittiies ã‚’è¸ã¾ãˆãªãŒã‚‰ç´¹ä»‹ã—ã¾ã—ãŸ
- CryptoKitties ã§å®Ÿéš›ã«ä½¿ã‚ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® ERC721 ã«ã¤ã„ã¦ã€ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ã‚„ãã®å‹•ä½œç¢ºèªã‚’é€šã˜ã¦ç†è§£ã‚’æ·±ã‚ã¾ã—ãŸ
